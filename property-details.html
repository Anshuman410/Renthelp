<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property Details | RentHelp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <header class="navbar">
    <div class="logo">RentHelp</div>
    <nav>
      <a href="tenant-dashboard.html">Dashboard</a>
      <a href="#" onclick="logout()">Logout</a>
    </nav>
  </header>

  <section class="full-bg" id="detailBg" style="background-image:url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750');">
    <div class="overlay-content">
      
      <div id="loadingState" class="glass-card">
        <h2 style="color: #ffd479;">Loading Property Details...</h2>
        <p>Please wait while we fetch the latest information.</p>
      </div>

      <div id="detailsCard" class="glass-card extra-large" style="display: none; text-align: left;">
        <div style="display: flex; flex-wrap: wrap; gap: 30px; align-items: flex-start;">
          
          <div style="flex: 1; min-width: 300px;">
            <img id="propImage" src="" alt="Property" style="width: 100%; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
          </div>

          <div style="flex: 1; min-width: 300px;">
            <h1 id="propTitle" style="color: #ffd479; font-size: 2.5rem; margin-bottom: 10px;">Property Title</h1>
            <p id="propLocation" style="font-size: 1.2rem; margin-bottom: 20px;">üìç Location</p>
            
            <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
              <h2 id="propPrice" style="color: #fff; margin-bottom: 10px;">Monthly Rent: ‚Çπ0</h2>
              <p id="propDesc" style="color: #ccc; line-height: 1.8;">Description goes here...</p>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
              <h3 style="color: #ffd479; margin-bottom: 10px;">Landlord Information</h3>
              <p>üë§ <span id="landlordName">Name</span></p>
              <p style="font-size: 0.8rem; color: #aaa;">*Contact details shared after you show interest.</p>
            </div>

            <button onclick="expressInterest()" class="btn-primary" style="margin-top: 30px; font-size: 1.1rem;">
              I'm Interested
            </button>
          </div>

        </div>
      </div>

    </div>
  </section>

  <script>
    const API_BASE = "https://renthelp.onrender.com/api";
    const token = localStorage.getItem("token");

    // Get Property ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const propertyId = urlParams.get('id');

    async function loadPropertyDetails() {
        if (!propertyId) {
            alert("Property ID not found in URL!");
            window.location.href = "tenant-dashboard.html";
            return;
        }

        try {
            // Fetching single property from the new backend route
            const res = await fetch(`${API_BASE}/properties/${propertyId}`, {
                headers: { "Authorization": "Bearer " + token }
            });

            if (!res.ok) throw new Error("Property not found");

            const p = await res.json();

            // Mapping Data to HTML
            document.getElementById("propTitle").innerText = p.title;
            document.getElementById("propLocation").innerText = `üìç ${p.location}`;
            document.getElementById("propPrice").innerText = `Monthly Rent: ‚Çπ${p.price}`;
            document.getElementById("propDesc").innerText = p.description || "No detailed description provided for this property.";
            document.getElementById("landlordName").innerText = p.landlord ? p.landlord.name : "Unknown Landlord";
            
            const imgElement = document.getElementById("propImage");
            const bgElement = document.getElementById("detailBg");
            const fallbackImg = 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750';

            imgElement.src = p.imageUrl || fallbackImg;
            bgElement.style.backgroundImage = `url('${p.imageUrl || fallbackImg}')`;

            // UI Toggle
            document.getElementById("loadingState").style.display = "none";
            document.getElementById("detailsCard").style.display = "block";

        } catch (err) {
            console.error("LOAD ERROR:", err);
            alert("Failed to load property details. It might have been deleted.");
            window.location.href = "tenant-dashboard.html";
        }
    }

    async function expressInterest() {
        try {
            const res = await fetch(`${API_BASE}/interests`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify({ propertyId: propertyId })
            });

            const data = await res.json();

            if (res.ok) {
                alert("Success! Your interest has been sent to the landlord. They will contact you soon.");
            } else {
                alert(data.message || "You have already shown interest in this property.");
            }
        } catch (err) {
            console.error("INTEREST ERROR:", err);
            alert("Server error. Please try again later.");
        }
    }

    function logout() {
        localStorage.clear();
        window.location.href = "login.html";
    }

    window.onload = loadPropertyDetails;
  </script>
</body>
</html>
