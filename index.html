<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RentHelp | Find Your Perfect Rental</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <!-- ================= NAVBAR ================= -->
  <header class="navbar">
    <div class="logo">RentHelp</div>
    <nav id="navLinks">
      <a href="login.html">Login</a>
      <a href="register.html">Register</a>
    </nav>
  </header>

  <!-- ================= HERO / SEARCH ================= -->
  <section class="full-bg"
    style="background-image:url('https://images.unsplash.com/photo-1505691938895-1758d7feb511');">

    <div class="overlay-content">
      <div class="glass-card extra-large">

        <h1>Find Your Next Home</h1>
        <p class="subtitle">Luxury & affordable rentals in one place</p>

        <!-- ================= SEARCH ================= -->
        <div class="search-box">
          <input type="text" id="location" placeholder="Location / Landmark" />
          <input type="number" id="minPrice" placeholder="Min Price" />
          <input type="number" id="maxPrice" placeholder="Max Price" />
          <button onclick="loadProperties()">Search</button>
        </div>

        <!-- ================= PROPERTY LIST ================= -->
        <div id="properties" class="grid"></div>

      </div>
    </div>
  </section>

  <!-- ================= SCRIPTS ================= -->
  <script>
    const API_BASE = "https://renthelp.onrender.com";
    const token = localStorage.getItem("token");
    const role = localStorage.getItem("role");

    /* ================= NAV UPDATE ================= */
    const nav = document.getElementById("navLinks");

    if (token && role) {
      if (role === "tenant") {
        nav.innerHTML = `
          <a href="tenant-dashboard.html">Dashboard</a>
          <a href="#" onclick="logout()">Logout</a>
        `;
      } else if (role === "landlord") {
        nav.innerHTML = `
          <a href="landlord-dashboard.html">Dashboard</a>
          <a href="#" onclick="logout()">Logout</a>
        `;
      } else if (role === "admin") {
        nav.innerHTML = `
          <a href="admin.html">Admin Panel</a>
          <a href="#" onclick="logout()">Logout</a>
        `;
      }
    }

    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("role");
      window.location.href = "login.html";
    }

    /* ================= LOAD PROPERTIES ================= */
    async function loadProperties() {
      const location = document.getElementById("location").value;
      const minPrice = document.getElementById("minPrice").value;
      const maxPrice = document.getElementById("maxPrice").value;

      let url = `${API_BASE}/api/properties?`;
      if (location) url += `location=${encodeURIComponent(location)}&`;
      if (minPrice) url += `minPrice=${minPrice}&`;
      if (maxPrice) url += `maxPrice=${maxPrice}&`;

      try {
        const res = await fetch(url);
        const properties = await res.json();
        renderProperties(properties);
      } catch (err) {
        console.error(err);
        alert("Server error");
      }
    }

    /* ================= RENDER ================= */
    function renderProperties(properties) {
      const container = document.getElementById("properties");
      container.innerHTML = "";

      if (!properties.length) {
        container.innerHTML = "<p>No available properties found.</p>";
        return;
      }

      properties.forEach(p => {
        const card = document.createElement("div");
        card.className = "property-card";

        card.innerHTML = `
          <h3>${p.title}</h3>
          <p><b>Location:</b> ${p.location}</p>
          <p><b>Rent:</b> â‚¹${p.price}</p>
          <p>${p.description || ""}</p>
          <button onclick="viewDetails('${p._id}')">
            View Details
          </button>
        `;

        container.appendChild(card);
      });
    }

    function viewDetails(id) {
      window.location.href = `property-details.html?id=${id}`;
    }

    // Initial load
    loadProperties();
  </script>

  
</body>
</html>

